<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深度克隆的实现 | 个人前端知识积累</title>
    <meta name="description" content="前端路漫漫，不知终点，不断记录，慢慢积累">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.27bd7ea7.css" as="style"><link rel="preload" href="/blog/assets/js/app.30905f38.js" as="script"><link rel="preload" href="/blog/assets/js/2.9b1e4969.js" as="script"><link rel="preload" href="/blog/assets/js/26.29ec861f.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.12b48d23.js"><link rel="prefetch" href="/blog/assets/js/11.d40d0aa9.js"><link rel="prefetch" href="/blog/assets/js/12.9fbe985a.js"><link rel="prefetch" href="/blog/assets/js/13.17381043.js"><link rel="prefetch" href="/blog/assets/js/14.37b27ed1.js"><link rel="prefetch" href="/blog/assets/js/15.b012dcd7.js"><link rel="prefetch" href="/blog/assets/js/16.c7a355f6.js"><link rel="prefetch" href="/blog/assets/js/17.84062c09.js"><link rel="prefetch" href="/blog/assets/js/18.b7283b3c.js"><link rel="prefetch" href="/blog/assets/js/19.4e9fe3e1.js"><link rel="prefetch" href="/blog/assets/js/20.0af675cd.js"><link rel="prefetch" href="/blog/assets/js/21.c804786d.js"><link rel="prefetch" href="/blog/assets/js/22.e9bfa410.js"><link rel="prefetch" href="/blog/assets/js/23.59f79aeb.js"><link rel="prefetch" href="/blog/assets/js/24.4a96332d.js"><link rel="prefetch" href="/blog/assets/js/25.823f05d5.js"><link rel="prefetch" href="/blog/assets/js/27.6b502373.js"><link rel="prefetch" href="/blog/assets/js/28.f954eb18.js"><link rel="prefetch" href="/blog/assets/js/29.ade49222.js"><link rel="prefetch" href="/blog/assets/js/3.c3e32d4f.js"><link rel="prefetch" href="/blog/assets/js/30.851de0d2.js"><link rel="prefetch" href="/blog/assets/js/31.9a586d36.js"><link rel="prefetch" href="/blog/assets/js/32.b886717e.js"><link rel="prefetch" href="/blog/assets/js/33.b90f8639.js"><link rel="prefetch" href="/blog/assets/js/34.1a260ee4.js"><link rel="prefetch" href="/blog/assets/js/35.3fbd8ceb.js"><link rel="prefetch" href="/blog/assets/js/36.4c12275b.js"><link rel="prefetch" href="/blog/assets/js/37.3077b871.js"><link rel="prefetch" href="/blog/assets/js/38.b35b52b2.js"><link rel="prefetch" href="/blog/assets/js/39.902380aa.js"><link rel="prefetch" href="/blog/assets/js/4.717b65d4.js"><link rel="prefetch" href="/blog/assets/js/40.9dcf98d6.js"><link rel="prefetch" href="/blog/assets/js/41.d4929502.js"><link rel="prefetch" href="/blog/assets/js/42.1a7a7063.js"><link rel="prefetch" href="/blog/assets/js/43.a66f3b3c.js"><link rel="prefetch" href="/blog/assets/js/44.f55aff1f.js"><link rel="prefetch" href="/blog/assets/js/45.89a2d03c.js"><link rel="prefetch" href="/blog/assets/js/46.e0cc0258.js"><link rel="prefetch" href="/blog/assets/js/47.07f77af7.js"><link rel="prefetch" href="/blog/assets/js/48.9ac981b6.js"><link rel="prefetch" href="/blog/assets/js/49.6017d2ad.js"><link rel="prefetch" href="/blog/assets/js/5.e9c816fb.js"><link rel="prefetch" href="/blog/assets/js/50.1adc58cc.js"><link rel="prefetch" href="/blog/assets/js/51.2c0879ac.js"><link rel="prefetch" href="/blog/assets/js/52.01b1c076.js"><link rel="prefetch" href="/blog/assets/js/53.fe87ea6f.js"><link rel="prefetch" href="/blog/assets/js/54.1f3d1f59.js"><link rel="prefetch" href="/blog/assets/js/6.08d9f722.js"><link rel="prefetch" href="/blog/assets/js/7.9dadbf5a.js"><link rel="prefetch" href="/blog/assets/js/8.7ad82f4b.js"><link rel="prefetch" href="/blog/assets/js/9.e634038b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.27bd7ea7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">个人前端知识积累</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/javaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">vue技术栈</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">react技术栈</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/blog/moduleComponents/" class="nav-link">组件封装</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试/随笔 Menu" class="dropdown-title"><span class="title">面试/随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/recordSelf/interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/blog/recordSelf/problem/" class="nav-link">随笔</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/javaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">vue技术栈</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">react技术栈</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/blog/moduleComponents/" class="nav-link">组件封装</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试/随笔 Menu" class="dropdown-title"><span class="title">面试/随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/recordSelf/interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/blog/recordSelf/problem/" class="nav-link">随笔</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/javaScript/" class="sidebar-link">介绍</a></li><li><a href="/blog/javaScript/1.array遍历.html" class="sidebar-link">1. array遍历</a></li><li><a href="/blog/javaScript/2.array判断是否包含元素.html" class="sidebar-link">2. array判断是否包含元素</a></li><li><a href="/blog/javaScript/3.深度克隆.html" class="active sidebar-link">3. 深度克隆</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/javaScript/3.深度克隆.html#一、前言" class="sidebar-link">一、前言</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/3.深度克隆.html#二、拷贝之数据类型" class="sidebar-link">二、拷贝之数据类型</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/3.深度克隆.html#三、数组方法中哪些是深拷贝，哪些是浅拷贝？" class="sidebar-link">三、数组方法中哪些是深拷贝，哪些是浅拷贝？</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/3.深度克隆.html#四、简单（常用）的深拷贝实现" class="sidebar-link">四、简单（常用）的深拷贝实现</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/3.深度克隆.html#五、实现比较完整的深拷贝" class="sidebar-link">五、实现比较完整的深拷贝</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/3.深度克隆.html#六、更完善的实现深拷贝-逼格更高" class="sidebar-link">六、更完善的实现深拷贝(逼格更高)</a></li></ul></li><li><a href="/blog/javaScript/4.call-apply-bind.html" class="sidebar-link">4. call、apply、bind实现</a></li><li><a href="/blog/javaScript/5.柯理化与反柯理化.html" class="sidebar-link">5. 柯理化与反柯理化</a></li><li><a href="/blog/javaScript/6.new原理实现.html" class="sidebar-link">6. new原理实现</a></li><li><a href="/blog/javaScript/7.函数节流与防抖.html" class="sidebar-link">7. 函数节流与防抖</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="深度克隆的实现"><a href="#深度克隆的实现" class="header-anchor">#</a> 深度克隆的实现</h3> <h2 id="一、前言"><a href="#一、前言" class="header-anchor">#</a> 一、前言</h2> <p>JavaScript中深拷贝和浅拷贝是一道非常常见的问题，深拷贝在实际项目中也是我们不可避免的。那我们该如何实现一个比较完善的深拷贝呢？</p> <h2 id="二、拷贝之数据类型"><a href="#二、拷贝之数据类型" class="header-anchor">#</a> 二、拷贝之数据类型</h2> <p><strong>1. 基本数据类型</strong>（String、Number、Boolean、Symbol、undefined、null）<br>
内存中存的是变量值 ==&gt;&gt; 拷贝的是直接拷贝的内存中的变量值 ==&gt;&gt; 拷贝后和拷贝前没有任何关系</p> <p><strong>2. 复合数据类型</strong>（Object、Array、Function、Date、Math、RegExp...）<br>
内存中存的是地址值（栈中存的是地址值，变量值是存在堆中） ==&gt;&gt; 拷贝的是地址值 ==&gt;&gt; 拷贝后和拷贝前是指向的同一个堆（同一个值）</p> <h2 id="三、数组方法中哪些是深拷贝，哪些是浅拷贝？"><a href="#三、数组方法中哪些是深拷贝，哪些是浅拷贝？" class="header-anchor">#</a> 三、数组方法中哪些是深拷贝，哪些是浅拷贝？</h2> <p><strong>1.深拷贝</strong></p> <ul><li><strong>concat()</strong>： 用于连接两个或多个数组，仅会返回被连接数组的一个副本，arrayObject.concat(arrayX,arrayX,……,arrayX)</li> <li><strong>jion()</strong>： 返回一个字符串。该字符串是通过把 arrayObject 的每个元素转换为字符串，然后把这些字符串连接起来,arrayObject.join(separator)</li> <li><strong>slice()</strong>： 如果数组是空的arrayObject.slice(start,end)，返回的是截取后组成的数组</li></ul> <p><strong>2. 浅拷贝</strong></p> <ul><li><strong>pop()</strong>:   删除 arrayObject 的最后一个元素，把数组长度减 1，并且返回它删除的元素的值。</li> <li><strong>reverse()</strong>:  该方法会改变原来的数组，而不会创建新的数组。arrayObject.reverse() 。</li> <li><strong>shift()</strong>:   数组的第一个元素从其中删除，并返回第一个元素的值。</li> <li><strong>sort()</strong>:   对数组的引用。请注意，数组在原数组上进行排序，不生成副本。</li> <li><strong>splice()</strong>:  *splice() 方法可删除从 index 处开始的零个或多个元素，并且用参数列表中声明的一个或多个值来替换那些被删除的元素。arrayObject.splice(index,howmany,item1,…..,itemX)</li> <li><strong>unshift()</strong>:  unshift() 方法可向数组的开头添加一个或更多元素，并返回新的长度。</li></ul> <h2 id="四、简单（常用）的深拷贝实现"><a href="#四、简单（常用）的深拷贝实现" class="header-anchor">#</a> 四、简单（常用）的深拷贝实现</h2> <p><code>JSON.parse(JSON.stringify(obj))</code> ：先将对象转为字符串，变为了基本数据类型，在将字符串转为对象。</p> <p><strong>注意：有什么缺陷？</strong><br> <code>JSON.parse(JSON.stringify())</code> 不支持函数、日期对象、正则、undefined...</p> <h2 id="五、实现比较完整的深拷贝"><a href="#五、实现比较完整的深拷贝" class="header-anchor">#</a> 五、实现比较完整的深拷贝</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 自己实现深拷贝 (类型判断) 递归 拷贝对象</span>
<span class="token comment">// 函数一般不拷贝，函数都是调用返回结果，不需要定义多次</span>
<span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>hash <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// null 和 undefined 在 == 号的情况下相等</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token comment">// 数据类型 string number boolean symbol</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token comment">// 正则 日期 typeof  对象</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [] / {}  cloneObj</span>
    <span class="token keyword">let</span> val <span class="token operator">=</span> hash<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果映射表中存在 直接将结果返回</span>
    <span class="token comment">// 这是避免重复引用，即 obj.b = obj</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 递归要有终止条件 这个就是终止条件</span>
        <span class="token keyword">return</span> val
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> cloneObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj<span class="token punctuation">.</span>constructor</span><span class="token punctuation">;</span> <span class="token comment">// 取当前传入对象的构造函数，并创建一个新的对象</span>
    hash<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>cloneObj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 如果不存在就创建映射</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 无论是对象还是数组 都可以循环</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 只要实例上的属性 </span>
            <span class="token comment">// 有可能 当前每一项中 内部还是一个引用类型</span>
            <span class="token comment">// 做一个映射关系 把他存起来</span>
            <span class="token comment">// 数据结构 队列 栈 链表 集合set hash表 树 图</span>
            cloneObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> cloneObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样的深拷贝基本是已经够我们用了！！</p> <h2 id="六、更完善的实现深拷贝-逼格更高"><a href="#六、更完善的实现深拷贝-逼格更高" class="header-anchor">#</a> 六、更完善的实现深拷贝(逼格更高)</h2> <ol><li>在JS中如何判断变量的类型</li></ol> <ul><li><p>typeof: 判断变量属于什么类型，只能判断基本数据类型<br>
返回值是对应类型的全小写字符串：number string boolean undefined symbol<br>
例外：typeof null ==&gt;&gt; object<br>
　　　typeof {} [] /^$/ Date ==&gt;&gt; object</p></li> <li><p>instanceof: 判断变量是否属于其余对象的实例<br>
主要依靠原型链判断，有一定的缺陷，比如手动修改原型链，就会造成结果的变化</p></li> <li><p>Object.prototype.toString.call(obj)
返回值是字符串<br> <strong>该方法能准确判断出遍历所属的类型</strong>
返回的值有哪些？</p></li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>object Boolean<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>object Number<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object String<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Null<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Undefined<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Symbol<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Object<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Function<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Array<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Error<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object RegExp<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Math<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object JSON<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object HTMLDocument<span class="token punctuation">]</span>
<span class="token punctuation">[</span>object Window<span class="token punctuation">]</span>
</code></pre></div><ol start="2"><li>基于<code>Object.prototype.toString.call(obj)</code>判断类型，实现深拷贝</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment">// 共用方法，判断变量的类型</span>
    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//[object Object]</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对类型进行分类</span>
<span class="token comment">// 基本数据类型以外的类型</span>
<span class="token keyword">let</span> <span class="token constant">OBJECT_TYPES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token regex">/^$/</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token function">getType</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 需要单独处理的数据类型</span>
<span class="token keyword">let</span> <span class="token constant">MAP_TYPE</span> <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">SET_TYPE</span> <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">SYMBOL_TYPE</span> <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">REGEXP_TYPE</span> <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token regex">/^$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token constant">CONSTRUCT_TYPES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token function">getType</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">clone</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token comment">// 利用Map做映射，避免循环引用</span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">OBJECT_TYPES</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> source<span class="token punctuation">;</span><span class="token comment">//基本类型直接返回  string boolean number</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 如果映射表中存在 直接将结果返回</span>
        <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">CONSTRUCT_TYPES</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">// 是new出来的变量，调用他自身的构造函数并传入变量自身，重新生成一个新的变量</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">source<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// new Date(oldDate); new Error(oldError);</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">source<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//{} []</span>
    map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 映射表中如果不存在, 就创建映射。key是变量自身（可以是对象），value是调用构造函数创建的新对象</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">SYMBOL_TYPE</span> <span class="token operator">===</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// 复制symbol类型</span>
        <span class="token keyword">return</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token class-name">Symbol</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">REGEXP_TYPE</span> <span class="token operator">===</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment">// 复制正则</span>
        <span class="token keyword">const</span> flags <span class="token operator">=</span> <span class="token regex">/\w*$/</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>source<span class="token punctuation">,</span> flags<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        target<span class="token punctuation">.</span>lastIndex <span class="token operator">=</span> source<span class="token punctuation">.</span>lastIndex<span class="token punctuation">;</span>        <span class="token comment">//正则已经调用，需要清除引用</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">SET_TYPE</span> <span class="token operator">==</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment">// 复制set</span>
        source<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> target<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">clone</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">MAP_TYPE</span> <span class="token operator">==</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token comment">// 复制map</span>
        source<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> target<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">clone</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*  for (const key in source) {//处理普通 对象 和数组
         target[key] = clone(source[key], map);//对象或数组的还要递归深拷贝
     } */</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> length <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> length<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// while 在一定程度上要比 for in 性能更高</span>
        <span class="token keyword">let</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        index<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>测试代码</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    married<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
    girlfriend<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    boyfriend<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    home<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'成都'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    map<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">getName</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    hobbies<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    error<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'我错了'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    pattern<span class="token punctuation">:</span> <span class="token regex">/^reg$/</span><span class="token punctuation">,</span>
    math<span class="token punctuation">:</span> Math<span class="token punctuation">,</span>
    json<span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">,</span>
    <span class="token comment">//document: document,           // 注意：只有浏览器才有document和window，node环境没有</span>
    <span class="token comment">//window: window</span>
<span class="token punctuation">}</span>
obj<span class="token punctuation">.</span>set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'ceshi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>obj <span class="token operator">=</span> obj<span class="token punctuation">;</span>


<span class="token keyword">let</span> newObj <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'=====newObj'</span><span class="token punctuation">,</span> newObj<span class="token punctuation">)</span>
<span class="token comment">/**
 * 测试while和for in消耗的时间对象
console.time('cost');
for (let i = 0; i &lt; 100000; i++) {
    clone(obj);
}
console.timeEnd('cost');
*/</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/javaScript/2.array判断是否包含元素.html" class="prev">2. array判断是否包含元素</a></span> <span class="next"><a href="/blog/javaScript/4.call-apply-bind.html">4. call、apply、bind实现</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.30905f38.js" defer></script><script src="/blog/assets/js/2.9b1e4969.js" defer></script><script src="/blog/assets/js/26.29ec861f.js" defer></script>
  </body>
</html>
