<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>call、apply、bind的实现 | 个人前端知识积累</title>
    <meta name="description" content="前端路漫漫，不知终点，不断记录，慢慢积累">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.27bd7ea7.css" as="style"><link rel="preload" href="/blog/assets/js/app.30905f38.js" as="script"><link rel="preload" href="/blog/assets/js/2.9b1e4969.js" as="script"><link rel="preload" href="/blog/assets/js/27.6b502373.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.12b48d23.js"><link rel="prefetch" href="/blog/assets/js/11.d40d0aa9.js"><link rel="prefetch" href="/blog/assets/js/12.9fbe985a.js"><link rel="prefetch" href="/blog/assets/js/13.17381043.js"><link rel="prefetch" href="/blog/assets/js/14.37b27ed1.js"><link rel="prefetch" href="/blog/assets/js/15.b012dcd7.js"><link rel="prefetch" href="/blog/assets/js/16.c7a355f6.js"><link rel="prefetch" href="/blog/assets/js/17.84062c09.js"><link rel="prefetch" href="/blog/assets/js/18.b7283b3c.js"><link rel="prefetch" href="/blog/assets/js/19.4e9fe3e1.js"><link rel="prefetch" href="/blog/assets/js/20.0af675cd.js"><link rel="prefetch" href="/blog/assets/js/21.c804786d.js"><link rel="prefetch" href="/blog/assets/js/22.e9bfa410.js"><link rel="prefetch" href="/blog/assets/js/23.59f79aeb.js"><link rel="prefetch" href="/blog/assets/js/24.4a96332d.js"><link rel="prefetch" href="/blog/assets/js/25.823f05d5.js"><link rel="prefetch" href="/blog/assets/js/26.29ec861f.js"><link rel="prefetch" href="/blog/assets/js/28.f954eb18.js"><link rel="prefetch" href="/blog/assets/js/29.ade49222.js"><link rel="prefetch" href="/blog/assets/js/3.c3e32d4f.js"><link rel="prefetch" href="/blog/assets/js/30.851de0d2.js"><link rel="prefetch" href="/blog/assets/js/31.9a586d36.js"><link rel="prefetch" href="/blog/assets/js/32.b886717e.js"><link rel="prefetch" href="/blog/assets/js/33.b90f8639.js"><link rel="prefetch" href="/blog/assets/js/34.1a260ee4.js"><link rel="prefetch" href="/blog/assets/js/35.3fbd8ceb.js"><link rel="prefetch" href="/blog/assets/js/36.4c12275b.js"><link rel="prefetch" href="/blog/assets/js/37.3077b871.js"><link rel="prefetch" href="/blog/assets/js/38.b35b52b2.js"><link rel="prefetch" href="/blog/assets/js/39.902380aa.js"><link rel="prefetch" href="/blog/assets/js/4.717b65d4.js"><link rel="prefetch" href="/blog/assets/js/40.9dcf98d6.js"><link rel="prefetch" href="/blog/assets/js/41.d4929502.js"><link rel="prefetch" href="/blog/assets/js/42.1a7a7063.js"><link rel="prefetch" href="/blog/assets/js/43.a66f3b3c.js"><link rel="prefetch" href="/blog/assets/js/44.f55aff1f.js"><link rel="prefetch" href="/blog/assets/js/45.89a2d03c.js"><link rel="prefetch" href="/blog/assets/js/46.e0cc0258.js"><link rel="prefetch" href="/blog/assets/js/47.07f77af7.js"><link rel="prefetch" href="/blog/assets/js/48.9ac981b6.js"><link rel="prefetch" href="/blog/assets/js/49.6017d2ad.js"><link rel="prefetch" href="/blog/assets/js/5.e9c816fb.js"><link rel="prefetch" href="/blog/assets/js/50.1adc58cc.js"><link rel="prefetch" href="/blog/assets/js/51.2c0879ac.js"><link rel="prefetch" href="/blog/assets/js/52.01b1c076.js"><link rel="prefetch" href="/blog/assets/js/53.fe87ea6f.js"><link rel="prefetch" href="/blog/assets/js/54.1f3d1f59.js"><link rel="prefetch" href="/blog/assets/js/6.08d9f722.js"><link rel="prefetch" href="/blog/assets/js/7.9dadbf5a.js"><link rel="prefetch" href="/blog/assets/js/8.7ad82f4b.js"><link rel="prefetch" href="/blog/assets/js/9.e634038b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.27bd7ea7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">个人前端知识积累</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/javaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">vue技术栈</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">react技术栈</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/blog/moduleComponents/" class="nav-link">组件封装</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试/随笔 Menu" class="dropdown-title"><span class="title">面试/随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/recordSelf/interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/blog/recordSelf/problem/" class="nav-link">随笔</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/javaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">vue技术栈</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">react技术栈</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/blog/moduleComponents/" class="nav-link">组件封装</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试/随笔 Menu" class="dropdown-title"><span class="title">面试/随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/recordSelf/interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/blog/recordSelf/problem/" class="nav-link">随笔</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/javaScript/" class="sidebar-link">介绍</a></li><li><a href="/blog/javaScript/1.array遍历.html" class="sidebar-link">1. array遍历</a></li><li><a href="/blog/javaScript/2.array判断是否包含元素.html" class="sidebar-link">2. array判断是否包含元素</a></li><li><a href="/blog/javaScript/3.深度克隆.html" class="sidebar-link">3. 深度克隆</a></li><li><a href="/blog/javaScript/4.call-apply-bind.html" class="active sidebar-link">4. call、apply、bind实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/javaScript/4.call-apply-bind.html#一、call的原理实现" class="sidebar-link">一、call的原理实现</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/4.call-apply-bind.html#二、apply的原理实现" class="sidebar-link">二、apply的原理实现</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/4.call-apply-bind.html#三、bind的原理实现" class="sidebar-link">三、bind的原理实现</a></li><li class="sidebar-sub-header"><a href="/blog/javaScript/4.call-apply-bind.html#补充：object-create的实现原理" class="sidebar-link">补充：Object.create的实现原理</a></li></ul></li><li><a href="/blog/javaScript/5.柯理化与反柯理化.html" class="sidebar-link">5. 柯理化与反柯理化</a></li><li><a href="/blog/javaScript/6.new原理实现.html" class="sidebar-link">6. new原理实现</a></li><li><a href="/blog/javaScript/7.函数节流与防抖.html" class="sidebar-link">7. 函数节流与防抖</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="call、apply、bind的实现"><a href="#call、apply、bind的实现" class="header-anchor">#</a> call、apply、bind的实现</h3> <h4 id="是什么"><a href="#是什么" class="header-anchor">#</a> 是什么?</h4> <ul><li>作用：改变this的指向</li> <li>call：第一个参数是为函数内部指定this指向，后续的参数则是函数执行时所需要的参数，一个一个传递。</li> <li>apply：第一个参数与call相同，为函数内部this指向，而函数的参数，则以数组的形式传递，作为apply第二参数。</li> <li><strong>call 的性能更好，因为apply内部也是和call一样的，但是他还要解析一遍参数数组</strong></li> <li>bind：创建一个新的函数，在 bind() 被调用时，这个新函数的 this 被指定为 bind() 的第一个参数，而其余参数将作为新函数的参数，供调用时使用</li> <li>call/apply/bind 在实现原理上有一定的相似，所以我只在call实现中写</li></ul> <h2 id="一、call的原理实现"><a href="#一、call的原理实现" class="header-anchor">#</a> 一、call的原理实现</h2> <p>实现原理：<strong>call的特点就是将自己（函数）放到一个对象上， 然后通过对象调用， 这样this就变成了对象。</strong><br>
实现四步骤（实现只需要四行代码）：</p> <ul><li>保存context 是上下文（即对象）</li> <li>将this即函数 放在对象上</li> <li>通过对象执行函数</li> <li>删除属性</li></ul> <p><strong>注意：不管多少次call  fn.call.call.call.call = 原型上的call方法</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">call2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/**
     * 1. context 是上下文，即函数call2的调用者，这里就是第一个参数
     * 保存上下文对象 ==&gt; 即改变后的this
     * 如果不存在，则用全局对象（浏览器是window，node是global）
     * 如果存在，即是他本身。但 Object(context) 的作用是保证context是一个对象，如果传入的是一个基本类型，它将被转换为对应类型的对象
     */</span>
    context <span class="token operator">=</span> context <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">:</span> window<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 2. 将this即函数 放在对象上
     * 注意：现在的call2就是一个普通的函数，谁调用他this就是谁
     * 即哪一个函数在调用call2改变this，则这里面的this就是这个函数
     */</span>
    <span class="token comment">// context[Symbol('fn')] = this</span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>      <span class="token comment">// 将要改变this的函数保存下来，注意fn是随便命名的，但不能使用已有属性名或者关键字。最好使用symbol，如：context[Symbol('fn')] = this</span>
    <span class="token comment">/**
     * 3. 通过对象执行函数
     * 因为现在这个函数是context的一个属性
     * 根据谁调用他this就是谁的原则，现在它的this就是context对象
     * 即this已经被改变
     */</span>
    context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 4. 删除属性
     * 首先，context肯定会是一个对象
     * 因为对象是引用类型，往上面添加属性会改变源对象
     * 为保证不影响源对象，把添加的属性删除
     */</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// ========== 测试代码 ==========</span>
<span class="token comment">/**
 * context 即执行上下文对象是 obj
 * this 即要改变this的函数是 getName
 */</span>
<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token parameter">age<span class="token punctuation">,</span> home</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> home<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//张三 10 成都</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'张三'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
getName<span class="token punctuation">.</span><span class="token function">call2</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'成都'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//  ========== 多次call ==========</span>
<span class="token comment">// 不管多少次call  fn.call.call.call.call = 原型上的call方法</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'100'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
fn<span class="token punctuation">.</span>call2<span class="token punctuation">.</span>call2<span class="token punctuation">.</span>call2<span class="token punctuation">.</span>call2<span class="token punctuation">.</span><span class="token function">call2</span><span class="token punctuation">(</span>fn1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 结果100</span>
</code></pre></div><h2 id="二、apply的原理实现"><a href="#二、apply的原理实现" class="header-anchor">#</a> 二、apply的原理实现</h2> <p>实现原理：<strong>apply的实现过程和call的实现过程类似，只是对于参数的处理有些不同。</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * apply的实现过程和call的实现过程类似，只是对于参数的处理有些不同。
 * 因为apply的传参是数组，使用apply函数的形参只有两个
 * 其他的逻辑处理和call一模一样
 */</span>

<span class="token comment">// 实现步骤如果有不理解的，请看call方法的实现</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// args 是一个数组</span>
    <span class="token comment">// 保存context 是上下文（即对象）</span>
    context <span class="token operator">=</span> context <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token punctuation">:</span> window<span class="token punctuation">;</span>
    <span class="token comment">// 将this即函数 放在对象上</span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> 
    <span class="token comment">// 通过对象执行函数</span>
    context<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 实际调用this改变后的this，需要将参数挨个传入，所以将args展开</span>
    <span class="token comment">// 删除属性</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// ========== 测试代码 ==========</span>
<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token parameter">age<span class="token punctuation">,</span> home</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> home<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'张三'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
getName<span class="token punctuation">.</span><span class="token function">apply2</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'成都'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="三、bind的原理实现"><a href="#三、bind的原理实现" class="header-anchor">#</a> 三、bind的原理实现</h2> <p>实现原理：<strong>bind 内容是通过call或者apply实现的</strong></p> <p>bind 返回的是一个改变this后的新函数，不会被立即执行。需要自己再次去手动调用执行</p> <p><strong>注意：使用bind传参有两种情况</strong></p> <ul><li>let newFn = fn.bind(obj, 参数1, 参数2)  ==&gt;&gt; 在使用bind的时候，依次传入</li> <li>newFn(参数3, 参数4)  ==&gt;&gt; 在调用bind返回的函数时传入参数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">/**
 * bind 返回的是一个改变this后的新函数，不会被立即执行。需要自己再次去手动调用执行
 * bind 内容是通过call或者apply实现的
 * 注意：使用bind传参有两种情况
 *      1. let newFn = fn.bind(obj, 参数1, 参数2)  ==&gt;&gt; 在使用bind的时候，依次传入
 *      2. newFn(参数3, 参数4)  ==&gt;&gt; 在调用bind返回的函数时传入参数
 */</span>
<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>outerArgs</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token operator">...</span>outerArgs<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>       <span class="token comment">// 使用call时参数依次传入</span>
    <span class="token comment">// return (...args) =&gt; this.apply(context, [...outerArgs, ...args])     // 使用apply时参数为数组</span>
<span class="token punctuation">}</span>

<span class="token comment">// ========== 测试代码 ==========</span>
<span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token parameter">age<span class="token punctuation">,</span> home</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> home<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'张三'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> bindGetName <span class="token operator">=</span> getName<span class="token punctuation">.</span><span class="token function">bind2</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bindGetName</span><span class="token punctuation">(</span><span class="token string">'成都'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="但是，这样实现的bind在函数使用-new-创建实例时是会报错的！！！"><a href="#但是，这样实现的bind在函数使用-new-创建实例时是会报错的！！！" class="header-anchor">#</a> 但是，这样实现的bind在函数使用 new 创建实例时是会报错的！！！</h3> <p>原因：官方文档有这么一句话：“<code>绑定函数也可以使用 new 运算符构造，它会表现为目标函数已经被构建完毕了似的。提供的 this 值会被忽略，但前置参数仍会提供给模拟函数。</code>”<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind" target="_blank" rel="noopener noreferrer">MDN文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。 看上去不是很明白，其实主要是说，当new完之后 新创建出来的实例要继承原函数的原型，并且this指向新创建出来的实例对象（绑定的this将失效）。</p> <p>但是我们自己实现的bind并没有实现这个功能，我们使用<code>IIFE</code>来实现一下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prototype</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    prototype<span class="token punctuation">.</span><span class="token function-variable function">bind2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">OThis<span class="token punctuation">,</span> <span class="token operator">...</span>outerArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> thatFunc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span><span class="token comment">//缓存当前的函数 Point  谁调用了bind2，谁就是this</span>
        <span class="token keyword">let</span> <span class="token function-variable function">fBound</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>innerArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//如果在这里判断我这个函数是new来调用的还是直接调用？</span>
            <span class="token keyword">return</span> <span class="token function">thatFunc</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>
                <span class="token comment">//如果你是在new这个绑定的后的函数的话，则bind绑定的时候传的oThis没有用了</span>
                <span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">thatFunc</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token punctuation">:</span> OThis<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span>outerArgs<span class="token punctuation">,</span> <span class="token operator">...</span>innerArgs<span class="token punctuation">]</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 改变返回函数的原型链 可以使用Object.create，也可以只有写thatFunc.prototype</span>
        <span class="token comment">//fBound.prototype = Object.create(thatFunc.prototype);</span>
        fBound<span class="token punctuation">.</span>prototype <span class="token operator">=</span> thatFunc<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
        <span class="token comment">// 返回新创建的函数</span>
        <span class="token keyword">return</span> fBound<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// ========== 测试代码 ==========</span>
<span class="token keyword">function</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Point</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> emptyObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> YPoint <span class="token operator">=</span> Point<span class="token punctuation">.</span><span class="token function">bind2</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> axiosPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">YPoint</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axiosPoint<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axiosPoint <span class="token keyword">instanceof</span> <span class="token class-name">Point</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 判断axiosPoint是否为Point的子类</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>axiosPoint <span class="token keyword">instanceof</span> <span class="token class-name">YPoint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 判断axiosPoint是否为YPoint的子类</span>
</code></pre></div><h2 id="补充：object-create的实现原理"><a href="#补充：object-create的实现原理" class="header-anchor">#</a> 补充：Object.create的实现原理</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prototype</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// 参数是要做为新对象原型的 变量对象</span>
    <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>    <span class="token comment">// 定义一个函数</span>
    <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> prototype<span class="token punctuation">;</span>        <span class="token comment">// 强制将原型指向 传入的对象</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 返回一个实例对象作为原型</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/javaScript/3.深度克隆.html" class="prev">3. 深度克隆</a></span> <span class="next"><a href="/blog/javaScript/5.柯理化与反柯理化.html">5. 柯理化与反柯理化</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.30905f38.js" defer></script><script src="/blog/assets/js/2.9b1e4969.js" defer></script><script src="/blog/assets/js/27.6b502373.js" defer></script>
  </body>
</html>
