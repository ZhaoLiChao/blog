<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>vue-quill-editor 富文本添加上传音频功能 | 个人前端知识积累</title>
    <meta name="description" content="前端路漫漫，不知终点，不断记录，慢慢积累">
    <link rel="icon" href="/blog/favicon.ico">
    
    <link rel="preload" href="/blog/assets/css/0.styles.27bd7ea7.css" as="style"><link rel="preload" href="/blog/assets/js/app.30905f38.js" as="script"><link rel="preload" href="/blog/assets/js/2.9b1e4969.js" as="script"><link rel="preload" href="/blog/assets/js/11.d40d0aa9.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.12b48d23.js"><link rel="prefetch" href="/blog/assets/js/12.9fbe985a.js"><link rel="prefetch" href="/blog/assets/js/13.17381043.js"><link rel="prefetch" href="/blog/assets/js/14.37b27ed1.js"><link rel="prefetch" href="/blog/assets/js/15.b012dcd7.js"><link rel="prefetch" href="/blog/assets/js/16.c7a355f6.js"><link rel="prefetch" href="/blog/assets/js/17.84062c09.js"><link rel="prefetch" href="/blog/assets/js/18.b7283b3c.js"><link rel="prefetch" href="/blog/assets/js/19.4e9fe3e1.js"><link rel="prefetch" href="/blog/assets/js/20.0af675cd.js"><link rel="prefetch" href="/blog/assets/js/21.c804786d.js"><link rel="prefetch" href="/blog/assets/js/22.e9bfa410.js"><link rel="prefetch" href="/blog/assets/js/23.59f79aeb.js"><link rel="prefetch" href="/blog/assets/js/24.4a96332d.js"><link rel="prefetch" href="/blog/assets/js/25.823f05d5.js"><link rel="prefetch" href="/blog/assets/js/26.29ec861f.js"><link rel="prefetch" href="/blog/assets/js/27.6b502373.js"><link rel="prefetch" href="/blog/assets/js/28.f954eb18.js"><link rel="prefetch" href="/blog/assets/js/29.ade49222.js"><link rel="prefetch" href="/blog/assets/js/3.c3e32d4f.js"><link rel="prefetch" href="/blog/assets/js/30.851de0d2.js"><link rel="prefetch" href="/blog/assets/js/31.9a586d36.js"><link rel="prefetch" href="/blog/assets/js/32.b886717e.js"><link rel="prefetch" href="/blog/assets/js/33.b90f8639.js"><link rel="prefetch" href="/blog/assets/js/34.1a260ee4.js"><link rel="prefetch" href="/blog/assets/js/35.3fbd8ceb.js"><link rel="prefetch" href="/blog/assets/js/36.4c12275b.js"><link rel="prefetch" href="/blog/assets/js/37.3077b871.js"><link rel="prefetch" href="/blog/assets/js/38.b35b52b2.js"><link rel="prefetch" href="/blog/assets/js/39.902380aa.js"><link rel="prefetch" href="/blog/assets/js/4.717b65d4.js"><link rel="prefetch" href="/blog/assets/js/40.9dcf98d6.js"><link rel="prefetch" href="/blog/assets/js/41.d4929502.js"><link rel="prefetch" href="/blog/assets/js/42.1a7a7063.js"><link rel="prefetch" href="/blog/assets/js/43.a66f3b3c.js"><link rel="prefetch" href="/blog/assets/js/44.f55aff1f.js"><link rel="prefetch" href="/blog/assets/js/45.89a2d03c.js"><link rel="prefetch" href="/blog/assets/js/46.e0cc0258.js"><link rel="prefetch" href="/blog/assets/js/47.07f77af7.js"><link rel="prefetch" href="/blog/assets/js/48.9ac981b6.js"><link rel="prefetch" href="/blog/assets/js/49.6017d2ad.js"><link rel="prefetch" href="/blog/assets/js/5.e9c816fb.js"><link rel="prefetch" href="/blog/assets/js/50.1adc58cc.js"><link rel="prefetch" href="/blog/assets/js/51.2c0879ac.js"><link rel="prefetch" href="/blog/assets/js/52.01b1c076.js"><link rel="prefetch" href="/blog/assets/js/53.fe87ea6f.js"><link rel="prefetch" href="/blog/assets/js/54.1f3d1f59.js"><link rel="prefetch" href="/blog/assets/js/6.08d9f722.js"><link rel="prefetch" href="/blog/assets/js/7.9dadbf5a.js"><link rel="prefetch" href="/blog/assets/js/8.7ad82f4b.js"><link rel="prefetch" href="/blog/assets/js/9.e634038b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.27bd7ea7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">个人前端知识积累</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/javaScript/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">vue技术栈</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">react技术栈</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/blog/moduleComponents/" class="nav-link">组件封装</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试/随笔 Menu" class="dropdown-title"><span class="title">面试/随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/recordSelf/interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/blog/recordSelf/problem/" class="nav-link router-link-active">随笔</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/javaScript/" class="nav-link">JavaScript</a></div><div class="nav-item"><a href="/blog/vue/" class="nav-link">vue技术栈</a></div><div class="nav-item"><a href="/blog/react/" class="nav-link">react技术栈</a></div><div class="nav-item"><a href="/blog/webpack/" class="nav-link">webpack</a></div><div class="nav-item"><a href="/blog/moduleComponents/" class="nav-link">组件封装</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试/随笔 Menu" class="dropdown-title"><span class="title">面试/随笔</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/recordSelf/interview/" class="nav-link">面试题</a></li><li class="dropdown-item"><!----> <a href="/blog/recordSelf/problem/" class="nav-link router-link-active">随笔</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/recordSelf/problem/" class="sidebar-link">介绍</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>问题集</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/recordSelf/problem/1.html转pdf_q.html" class="sidebar-link">1. html页面转pdf下载</a></li><li><a href="/blog/recordSelf/problem/2.vue-quill-editor上传音频.html" class="active sidebar-link">2. vue-quill-editor富文本添加上传音频功能</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>总结</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="vue-quill-editor-富文本添加上传音频功能"><a href="#vue-quill-editor-富文本添加上传音频功能" class="header-anchor">#</a> vue-quill-editor 富文本添加上传音频功能</h3> <h4 id="_1-前言"><a href="#_1-前言" class="header-anchor">#</a> 1. 前言</h4> <p>vue-quill-editor 是vue项目中常用的富文本插件，其功能能满足大部分的项目需求。但是，最近项目中，需要在富文本中上传音频文件，但是vue-quill-editor这个富文本仅支持图片，视频上传；所以这个功能需要自定义。</p> <p><strong>怎么实现这个功能？</strong></p> <ul><li>写一个只能上传音频的组件，并且隐藏</li> <li>在富文本插件的toolbar定义一个按钮，点击时调用上传组件</li> <li>监听上传成功的回调函数，在富文本输入框中插入音频标签</li></ul> <h4 id="_2-功能实现"><a href="#_2-功能实现" class="header-anchor">#</a> 2. 功能实现</h4> <h4 id="_2-1-基于element-ui实现上传组件，并且隐藏（不能让用户点击）"><a href="#_2-1-基于element-ui实现上传组件，并且隐藏（不能让用户点击）" class="header-anchor">#</a> 2.1 基于Element-ui实现上传组件，并且隐藏（不能让用户点击）</h4> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--
首先，必须隐藏这个元素：display:none；
v-loading.fullscreen.lock：设置上传时显示loading，值为true/false；
action：设置上传的地址；
before-upload：上传前的钩子函数，验证是否为音频文件；
on-success：上传成功的钩子函数；
on-progress：上传时的钩子函数，设置显示loading
 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>none</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-upload</span>
        <span class="token attr-name">v-loading.fullscreen.lock</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fullscreenLoading<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>actionUrl<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:before-upload</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>beforeUpload<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:on-success</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>handleSuccess<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">:on-progress</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uploadIng<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-button</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>small<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>uploadVoiceBtn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>upload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-upload</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>对应的钩子函数：</strong></p> <ul><li>actionUrl：直接根据后台接口赋值即可</li> <li>beforeUpload：验证是否为音频</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">beforeUpload</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// file.type好像只能返回图片的格式，其他的将会是 &quot;&quot;， 所以需要自己获取后缀名判断文件格式</span>
    <span class="token keyword">let</span> pointIndex <span class="token operator">=</span> file<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fileType <span class="token operator">=</span> file<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>pointIndex<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//获取到文件后缀名</span>
    <span class="token comment">// if (fileType !== 'mp3' &amp;&amp; fileType !== 'ogg' &amp;&amp; fileType !== 'wav') {</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fileType <span class="token operator">!==</span> <span class="token string">'mp3'</span> <span class="token operator">&amp;&amp;</span> fileType <span class="token operator">!==</span> <span class="token string">'ogg'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'你选择的文件不是音频哦，仅支持mp3和ogg格式'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><ul><li>handleSuccess：上传成功的回调，主要功能实现的地方，后面介绍</li> <li>uploadIng：设置显示loading</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">uploadIng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">//上传时显示loading</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fullscreenLoading <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-2-在富文本插件的toolbar定义一个按钮，点击时调用上传组件"><a href="#_2-2-在富文本插件的toolbar定义一个按钮，点击时调用上传组件" class="header-anchor">#</a> 2.2 在富文本插件的toolbar定义一个按钮，点击时调用上传组件</h4> <p>注意：vue-quill-editor是基于quill富文本的二次封装（源码可以很容易看出来），所以需要看配置方法的直接去看quill即可<br> <strong>A. 修改 editorOption 配置，添加一个按钮：</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//富文本设置</span>
editorOption<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    modules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token punctuation">,</span>            <span class="token comment">//其他配置，如quill-image-extend-module</span>
        toolbar<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            container<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">[</span><span class="token string">'bold'</span><span class="token punctuation">,</span> <span class="token string">'italic'</span><span class="token punctuation">,</span> <span class="token string">'underline'</span><span class="token punctuation">,</span> <span class="token string">'strike'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">'size'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">'large'</span><span class="token punctuation">,</span> <span class="token string">'huge'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">'header'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token string">'color'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'background'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">'blockquote'</span><span class="token punctuation">,</span> <span class="token string">'code-block'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">'link'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span><span class="token string">'voice'</span><span class="token punctuation">]</span>     <span class="token comment">//新添加的工具</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            handlers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'voice'</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>     <span class="token comment">//添加工具方法，即点击时模仿点击上传组件的按钮</span>
                  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.uploadVoiceBtn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">initVoiceButton</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment">//初始化&quot;voice&quot;按钮样式</span>
        <span class="token keyword">const</span> voiceButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ql-voice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//&quot;ql-&quot; 是插件自动加的前缀</span>

        <span class="token comment">// 添加样式，使用fontawesome初始化图标的样式</span>
        voiceButton<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'fa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        voiceButton<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'fa-volume-up'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        voiceButton<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'fa-lg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 当然，可以直接手写样式，如：</span>
        <span class="token comment">// voiceButton.style.cssText = &quot;width:80px; border:1px solid #ccc; border-radius:5px;&quot;;</span>
        <span class="token comment">// voiceButton.innerText=&quot;上传音频&quot;;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><strong>B. mounted中初始化显示按钮</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>editorOption<span class="token punctuation">.</span><span class="token function">initVoiceButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//初始化音频图标，这样才能显示</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>添加完成后效果：
<img src="data:image/png;base64,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o9nI62vOnDmYOXNm/eRWfkR+7NixeP31122BzgnB55wTxcjG6XOtubhba82aNxO44dpoTPTcPnHxeDZ5criMxf9zDC4X36C4SN/QjEegQSFRrFBYuinWozAhZrvYgjNmpVsFW2ozzTmm0xKgadbEGQX3CKgN3WOZTCU5RWSk8WQ6ztZqqxnzaSYcUfzxOdTcoWTx1ghuth9f1BYuXNigSArztm3b2t7h3NzcBtu0AsTF4ynQIiACIiACIiACIhBXAnHweMb0eFqoxzMK329MMatwERABERABERABERCBFkpAwrOFNqwOSwREQAREQAREQAS8RkDC02stIntEQAREQAREQAREoIUSkPBsoQ2rwxIBERABERABERABrxGQ8PRai8geERABERABERABEWihBCQ8W2jD6rBEQAREQAREoFUTSKn/tRHgzJnkQ+G0OaXlyLWWcyTJd0rJYhEQAREQAREQgVgR6NLZV/Lnu33xZIj946T1M3rf+Cx1HosvNSljEp5J2WwyWgREQAREQAREICSBQQN8m98pBZaXANUNf3XJl8FDsarDwONPAYeP1hp1/nlAn14eMrB5psTll4uaZ6L2FgEREAEREAEREIEICWT1Bq61fjnoox21O/55BcC/ZAsTrZ8Udw4bSDb7/eyVx9MPiFZFQAREQAREQARaCIEnCoC+fZL3YMaMAkb/W/LaH8ByeTwDQFGSCIiACIiACIhACyBwbprl5XwGeONt4O3NwL5K4KQ1ftLLgTZfbonl/xgJ5Pb3sqVR2abfao8Km3YSAREQAREQAREQARGIlECTHs+dO3dGWqbyi4AIiIAIiIAIiIAIiEAjAk0Kz5ycnEY7KUEEREAEREAEREAEREAEIiWgyUWRElN+ERABERABERABERCBqAhIeEaFTTuJgAiIgAiIgAiIgAhESkDCM1Jiyi8CIiACIiACIiACIhAVAQnPqLBpJxEQAREQAREQAREQgUgJSHhGSkz5RUAEREAEREAEREAEoiLw/yj0f+hRGr51AAAAAElFTkSuQmCC" alt="自定义上传音频按钮"></p> <p>如果是在不同的文件，即配置文件和组件调用不在同一个文件，请参考：<a href="https://blog.csdn.net/w390058785/article/details/84337859" target="_blank" rel="noopener noreferrer">在quill-editor组件工具栏中添加自定义的方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这篇文章在自定义按钮部分写的很清楚！</p> <h4 id="_3-监听上传成功的回调函数，在富文本输入框中插入音频标签"><a href="#_3-监听上传成功的回调函数，在富文本输入框中插入音频标签" class="header-anchor">#</a> 3. 监听上传成功的回调函数，在富文本输入框中插入音频标签</h4> <p><strong>这一步骤是整个功能的核心！！！</strong></p> <p>网上有很多显示自定义功能显示的文字，但主要都是以图片为主。大多用的都是 quill 的 <code>pasteHTML</code> 方法，但我试了以后并不能实现。将<code>&lt;audio src=&quot;&quot; controls=&quot;true&quot; &gt;&lt;/audio&gt;</code>这样的字符串加入到富文本绑定的变量上面后，并不能显示。最后，可以使用<code>insertEmbed</code>插入对象到富文本中，<strong>但是</strong>，这个方法好像也只能插入<code>image</code>，不能插入其他的标签。</p> <p><strong>解决方法：自定义FileBlot ==&gt;&gt; Quill调用自定义Blot （即自定义一个Quill能解析显示的标签，并且添加的里面去）</strong></p> <ul><li>quill-editor 组件调用</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>import { quillEditor, Quill } from 'vue-quill-editor'

components: {
    quillEditor
},

<span class="token comment">&lt;!-- change是内容改变后的回调函数，做页面处理，这里不说，自行根据系统页面处理 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>quill-editor</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myTextEditor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorTempValue<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:options</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>editorOption<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onEditorChange($event)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>quill-editor</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>handleSuccess：上传成功的回调，主要功能实现的地方</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">handleSuccess</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> file<span class="token punctuation">,</span> fileList</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fullscreenLoading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取富文本组件实例</span>
    <span class="token keyword">let</span> quill <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>myTextEditor<span class="token punctuation">.</span>quill
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>code <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment">// 如果上传成功</span>
        <span class="token keyword">let</span> length <span class="token operator">=</span> quill<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>index<span class="token punctuation">;</span>  <span class="token comment">// 获取光标所在位置</span>

        <span class="token keyword">let</span> BlockEmbed <span class="token operator">=</span> Quill<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'blots/block/embed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">class</span> <span class="token class-name">AudioBlot</span> <span class="token keyword">extends</span> <span class="token class-name">BlockEmbed</span> <span class="token punctuation">{</span>
            <span class="token keyword">static</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">,</span> value<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//设置audio的src属性</span>
                node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'controls'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//设置audio的controls，否则他将不会显示</span>
                node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'controlsList'</span><span class="token punctuation">,</span> <span class="token string">'nodownload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//设置audio的下载功能为不能下载</span>
                node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'voice'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//设置一个id</span>
                <span class="token keyword">return</span> node<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// static value(node) {</span>
            <span class="token comment">//   return {</span>
            <span class="token comment">//     url: node.getAttribute('src')</span>
            <span class="token comment">//   };</span>
            <span class="token comment">// }</span>
        <span class="token punctuation">}</span>
        AudioBlot<span class="token punctuation">.</span>blotName <span class="token operator">=</span> <span class="token string">'audio'</span><span class="token punctuation">;</span>
        AudioBlot<span class="token punctuation">.</span>tagName <span class="token operator">=</span> <span class="token string">'audio'</span><span class="token punctuation">;</span>      <span class="token comment">//自定义的标签为audio</span>
        Quill<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>AudioBlot<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// insertEmbed(index: Number(插入的位置), type: String(标签类型), value: any(参数，将传入到create的方法中去), source: String = 'api')</span>
        quill<span class="token punctuation">.</span><span class="token function">insertEmbed</span><span class="token punctuation">(</span>length<span class="token punctuation">,</span> <span class="token string">'audio'</span><span class="token punctuation">,</span>  <span class="token punctuation">{</span>url<span class="token punctuation">:</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;api&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        quill<span class="token punctuation">.</span><span class="token function">setSelection</span><span class="token punctuation">(</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//光标位置向后移动一位</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 上传失败，提示错误信息</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>完成后效果：<br> <img src="/blog/assets/img/quill-upload-voice.e1b37f39.gif" alt="实现自定义上传音频功能"></p> <h4 id="_4-遇到的问题-当然，如果你没有遇到，请忽略"><a href="#_4-遇到的问题-当然，如果你没有遇到，请忽略" class="header-anchor">#</a> 4. 遇到的问题  ==&gt;&gt; 当然，如果你没有遇到，请忽略</h4> <p>在添加完音频文件后，离开输入框，做其他的操作；之后再回来，发现音频文件失效了，src属性变成了<code>undefined</code>;<br>
即</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>audio src<span class="token operator">=</span><span class="token string">&quot;http://sysssc.oss-cn-shenzhen.aliyuncs.com//osstest/20200114/123fe211b5e74adda9b758087ab58beb.mp3&quot;</span> controls<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> controlslist<span class="token operator">=</span><span class="token string">&quot;nodownload&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;voice&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>audio<span class="token operator">&gt;</span>
</code></pre></div><p>变成了</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>audio src<span class="token operator">=</span><span class="token string">&quot;undefined&quot;</span> controls<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> controlslist<span class="token operator">=</span><span class="token string">&quot;nodownload&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;voice&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>audio<span class="token operator">&gt;</span>
</code></pre></div><p>花了大量时间找寻原因之后，发现：<br>
在 <code>vue-quill-editor/src/editor.vue</code> 里面发现监听的<code>value</code>时使用了<code>this.quill.pasteHTML(newVal)</code>，这一句造成了<code>src</code>属性的丢失。它内部其实采用了<a href="http://doc.quilljs.cn/1409381#dangerouslyPasteHTML_52" target="_blank" rel="noopener noreferrer">dangerouslyPasteHTML<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>重写。</p> <p>改成：<br> <code>this.$refs.editor.children[0].innerHTML = newVal;</code>即可，监听<code>content</code>亦然</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Watch content change</span>
<span class="token function">value</span><span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>quill<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newVal <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_content <span class="token operator">=</span> newVal
      <span class="token comment">// pasteHTML会导致添加音频时，&lt;audio src='undefined' ...&gt;</span>
      <span class="token comment">// this.quill.pasteHTML(newVal)</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>editor<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>quill<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>参考文章：<br> <a href="https://blog.csdn.net/w390058785/article/details/84337859" target="_blank" rel="noopener noreferrer">【Vue】在quill-editor组件工具栏中添加自定义的方法（添加源码编辑功能）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.jianshu.com/p/9e4e4d955d0f" target="_blank" rel="noopener noreferrer">富文本编辑vue-quill-editor自定义图片、文件上传<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://segmentfault.com/q/1010000012055453" target="_blank" rel="noopener noreferrer">insertEmbed自定义插入a标签<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="http://doc.quilljs.cn/1409423" target="_blank" rel="noopener noreferrer">Quill官方中文文档(配置详情，insertEmbed方法)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://quilljs.com/guides/cloning-medium-with-parchment/" target="_blank" rel="noopener noreferrer">FileBlot官方用法详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/recordSelf/problem/1.html转pdf_q.html" class="prev">1. html页面转pdf下载</a></span> <span class="next"><a href="/blog/recordSelf/problem/RN开发感受_s.html">react native开发感受</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.30905f38.js" defer></script><script src="/blog/assets/js/2.9b1e4969.js" defer></script><script src="/blog/assets/js/11.d40d0aa9.js" defer></script>
  </body>
</html>
